<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="md:grid md:grid-cols-3 md:gap-6">
    <div class="md:col-span-1">
      <div class="px-4 sm:px-0">
        <h3 class="text-lg font-medium leading-6 text-gray-900">Repository Connections</h3>
        <p class="mt-1 text-sm text-gray-600">
          Connect your accounts to fetch pull requests. Your tokens are encrypted and stored securely.
        </p>
      </div>
    </div>
    <div class="mt-5 md:mt-0 md:col-span-2">
      <div class="shadow sm:rounded-md sm:overflow-hidden bg-white">
        <div class="px-4 py-5 space-y-6 sm:p-6">
          <% @providers.each do |provider| %>
            <% connection = @connections[provider] %>
            <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 border-b border-gray-100 pb-6 last:border-0 last:pb-0">
              <div class="sm:col-span-6">
                <div class="flex items-center justify-between mb-2">
                  <label for="access_token_<%= provider %>" class="block text-sm font-medium text-gray-700 capitalize flex items-center">
                    <% case provider %>
                    <% when 'github' %>
                      <svg class="h-5 w-5 mr-2 text-gray-900" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" /></svg>
                    <% when 'gitlab' %>
                      <svg class="h-5 w-5 mr-2 text-orange-600" fill="currentColor" viewBox="0 0 24 24"><path d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .41.26l2.47 7.6h8.6l2.47-7.6a.43.43 0 0 1 .41-.26.42.42 0 0 1 .11.02l2.44 7.51 1.22 3.78a.84.84 0 0 1-.3.94z"/></svg>
                    <% when 'bitbucket' %>
                      <svg class="h-5 w-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24"><path d="M2.65 3C2.05 3 1.55 3.5 1.6 4.1L2.7 20.4C2.75 21.3 3.5 22 4.4 22H19.6C20.5 22 21.25 21.3 21.3 20.4L22.4 4.1C22.45 3.5 21.95 3 21.35 3H2.65ZM13.8 15.4H10.2L9.4 9.6H14.6L13.8 15.4Z" /></svg>
                    <% end %>
                    <%= provider.titleize %>
                  </label>
                  <% if connection %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      Connected
                    </span>
                  <% else %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      Not Connected
                    </span>
                  <% end %>
                </div>
                
                <%= form_with url: settings_update_path, method: :post, local: true do |f| %>
                  <%= f.hidden_field :provider, value: provider %>
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <%= f.password_field :access_token, value: connection&.access_token, placeholder: "Paste Personal Access Token", class: "focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-l-md sm:text-sm border-gray-300" %>
                    <%= f.submit "Save", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-r-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer" %>
                  </div>
                <% end %>
                
                <% if connection %>
                  <div class="mt-2 text-right">
                    <%= link_to "Remove Connection", settings_update_path(provider: provider, access_token: ""), data: { turbo_method: :post, turbo_confirm: "Are you sure you want to disconnect #{provider.titleize}?" }, class: "text-xs text-red-600 hover:text-red-900" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
          <%= link_to "Back to Dashboard", root_path, class: "text-sm font-medium text-indigo-600 hover:text-indigo-500" %>
        </div>
      </div>
    </div>
  </div>
</div>
